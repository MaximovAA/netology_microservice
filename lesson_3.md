# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система - yandex cloud
- система контроля версий Git - gitlab или yandex cloud gitlab
- репозиторий на каждый сервис - gitlab
- запуск сборки по событию из системы контроля версий - gitlab ci
- запуск сборки по кнопке с указанием параметров - gitlab ci
- возможность привязать настройки к каждой сборке - gitlab ci
- возможность создания шаблонов для различных конфигураций сборок - helm
- возможность безопасного хранения секретных данных (пароли, ключи доступа) - bitwarden, vaultwarden, k8s secret
- несколько конфигураций для сборки из одного репозитория - разные ветки gitlab ci
- кастомные шаги при сборке - gitlab ci
- собственные докер-образы для сборки проектов - gitlab registry
- возможность развернуть агентов сборки на собственных серверах - gitlab runner
- возможность параллельного запуска нескольких сборок - gitlab ci
- возможность параллельного запуска тестов - gitlab ci

Обоснуйте свой выбор.
```
Yandex cloud на данный момент является одним из самых функционально развитых облачных провайдеров, доступных на территории России.
Gitlab являетя мультифункциональной платформой, полностью закрывающей основные процессы ci/cd,
который можно использовать как в облачном варианте так и развернуть локально. Также YC позволяет разворачивать свой gitlab в рамках проектного окружения
или настраивать зеркала существующих. 
Gitlab имеет свой набор инструментария, полностью закрывающий вопросы тонкой настройки выполнения пайплайнов в рамках проектов и разных окружений,
а так же тестирования и хранения артефактов. Поддерживает настроку динамических шаблонов по средствам переменных. Позволяет разграничивать доступ и права.
При использовании в качестве системы контейнеризации k8s, лучшим на сегодняшний день инструментом для создания и управления шаблонами является helm,
который позволяет использовать огромное количество готовых community шаблонов или создавать свои.
В свою очередь взаимодействие k8s с gitlab происходит посредством токенов. Runner-ы gitlab запускаются так же в k8s. 
В качестве безопасного хранения чувствительной информации отлично зарекомендовали себя такие системы как bitwarden, vaultwarden,
которые позволяеют разгранияивать доступы и поддерживают шифрование. Что касается хранения сервисных паролей, токенов и учетных данных,
допустимо использование как внешних хранилищ посредством дополнительных операторов (ESO), так и внутренних секретов k8s
```
## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему - grafana+loki 
- минимальные требования к приложениям, сбор логов из stdout - loki
- гарантированная доставка логов до центрального хранилища - loki + s3
- обеспечение поиска и фильтрации по записям логов - grafana+loki 
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов - grafana+loki 
- возможность дать ссылку на сохранённый поиск по записям логов - grafana+loki 

Обоснуйте свой выбор.
```
Одним из быстро развивающихся инструменом для сбора и организации логов на сегодняшний день является loki.
Loki создан разработчиками grafana и легко интегрируется и предоставляет доступ к собранным логам в интерфейсе grafana.
Ведет историю предыдущих запросов для удобства. Собирает логи по средствам promtail.
```
## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему - prometeus+tanos 
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network - prometeus+tanos 
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network - prometeus+tanos 
- сбор метрик, специфичных для каждого сервиса - prometeus+tanos 
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию - tanos+grafana 
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы - tanos+grafana 

Обоснуйте свой выбор.
```
В основе предлоенного решения лежит сборщик метрик prometeus. При использовании дополнительных экспортеров, позволяет орагнизовать сбор метрик как с виртуальных машин,
так и с систем контейнеризации (node exporter, cAdvisor, prometheus-operator и тд). В связке с таносом позволяет объеденить несколько контуров prometeus в один источник данных.
В качестве системы визуализации предлагается использовать grafana с источником данных tanos.
У grafana развитое коммьюнити и она имеет огромное количество легкоподключаемых готовых дашбордов,
поддерживает экспорт и импорт дашбордов и иснтрументарий для разработки своих в случае необходимости.
```
